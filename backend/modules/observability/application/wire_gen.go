// Code generated by Wire. DO NOT EDIT.

//go:generate go run -mod=mod github.com/google/wire/cmd/wire
//go:build !wireinject
// +build !wireinject

package application

import (
	"github.com/coze-dev/coze-loop/backend/infra/ck"
	"github.com/coze-dev/coze-loop/backend/infra/db"
	"github.com/coze-dev/coze-loop/backend/infra/external/benefit"
	"github.com/coze-dev/coze-loop/backend/infra/idgen"
	"github.com/coze-dev/coze-loop/backend/infra/limiter"
	"github.com/coze-dev/coze-loop/backend/infra/lock"
	"github.com/coze-dev/coze-loop/backend/infra/metrics"
	"github.com/coze-dev/coze-loop/backend/infra/mq"
	"github.com/coze-dev/coze-loop/backend/infra/redis"
	"github.com/coze-dev/coze-loop/backend/kitex_gen/coze/loop/data/dataset/datasetservice"
	"github.com/coze-dev/coze-loop/backend/kitex_gen/coze/loop/data/tag/tagservice"
	"github.com/coze-dev/coze-loop/backend/kitex_gen/coze/loop/evaluation/evaluationsetservice"
	"github.com/coze-dev/coze-loop/backend/kitex_gen/coze/loop/evaluation/evaluatorservice"
	"github.com/coze-dev/coze-loop/backend/kitex_gen/coze/loop/evaluation/experimentservice"
	"github.com/coze-dev/coze-loop/backend/kitex_gen/coze/loop/foundation/auth/authservice"
	"github.com/coze-dev/coze-loop/backend/kitex_gen/coze/loop/foundation/file/fileservice"
	"github.com/coze-dev/coze-loop/backend/kitex_gen/coze/loop/foundation/user/userservice"
	config2 "github.com/coze-dev/coze-loop/backend/modules/observability/domain/component/config"
	mq2 "github.com/coze-dev/coze-loop/backend/modules/observability/domain/component/mq"
	"github.com/coze-dev/coze-loop/backend/modules/observability/domain/component/rpc"
	"github.com/coze-dev/coze-loop/backend/modules/observability/domain/component/scheduledtask"
	storage2 "github.com/coze-dev/coze-loop/backend/modules/observability/domain/component/storage"
	"github.com/coze-dev/coze-loop/backend/modules/observability/domain/metric/entity"
	repo3 "github.com/coze-dev/coze-loop/backend/modules/observability/domain/metric/repo"
	service2 "github.com/coze-dev/coze-loop/backend/modules/observability/domain/metric/service"
	"github.com/coze-dev/coze-loop/backend/modules/observability/domain/metric/service/metric/general"
	"github.com/coze-dev/coze-loop/backend/modules/observability/domain/metric/service/metric/model"
	service4 "github.com/coze-dev/coze-loop/backend/modules/observability/domain/metric/service/metric/service"
	"github.com/coze-dev/coze-loop/backend/modules/observability/domain/metric/service/metric/tool"
	entity3 "github.com/coze-dev/coze-loop/backend/modules/observability/domain/task/entity"
	repo4 "github.com/coze-dev/coze-loop/backend/modules/observability/domain/task/repo"
	service3 "github.com/coze-dev/coze-loop/backend/modules/observability/domain/task/service"
	"github.com/coze-dev/coze-loop/backend/modules/observability/domain/task/service/taskexe/processor"
	scheduledtask2 "github.com/coze-dev/coze-loop/backend/modules/observability/domain/task/service/taskexe/scheduledtask"
	"github.com/coze-dev/coze-loop/backend/modules/observability/domain/task/service/taskexe/tracehub"
	entity2 "github.com/coze-dev/coze-loop/backend/modules/observability/domain/trace/entity"
	"github.com/coze-dev/coze-loop/backend/modules/observability/domain/trace/entity/collector/exporter"
	processor2 "github.com/coze-dev/coze-loop/backend/modules/observability/domain/trace/entity/collector/processor"
	"github.com/coze-dev/coze-loop/backend/modules/observability/domain/trace/entity/collector/receiver"
	repo2 "github.com/coze-dev/coze-loop/backend/modules/observability/domain/trace/repo"
	"github.com/coze-dev/coze-loop/backend/modules/observability/domain/trace/service"
	"github.com/coze-dev/coze-loop/backend/modules/observability/domain/trace/service/collector/exporter/clickhouseexporter"
	"github.com/coze-dev/coze-loop/backend/modules/observability/domain/trace/service/collector/processor/queueprocessor"
	"github.com/coze-dev/coze-loop/backend/modules/observability/domain/trace/service/collector/receiver/rmqreceiver"
	"github.com/coze-dev/coze-loop/backend/modules/observability/domain/trace/service/trace/span_filter"
	"github.com/coze-dev/coze-loop/backend/modules/observability/domain/trace/service/trace/span_processor"
	"github.com/coze-dev/coze-loop/backend/modules/observability/infra/collector"
	"github.com/coze-dev/coze-loop/backend/modules/observability/infra/config"
	metrics2 "github.com/coze-dev/coze-loop/backend/modules/observability/infra/metrics"
	"github.com/coze-dev/coze-loop/backend/modules/observability/infra/mq/producer"
	"github.com/coze-dev/coze-loop/backend/modules/observability/infra/repo"
	ck2 "github.com/coze-dev/coze-loop/backend/modules/observability/infra/repo/ck"
	"github.com/coze-dev/coze-loop/backend/modules/observability/infra/repo/mysql"
	redis2 "github.com/coze-dev/coze-loop/backend/modules/observability/infra/repo/redis"
	"github.com/coze-dev/coze-loop/backend/modules/observability/infra/rpc/auth"
	"github.com/coze-dev/coze-loop/backend/modules/observability/infra/rpc/dataset"
	"github.com/coze-dev/coze-loop/backend/modules/observability/infra/rpc/evaluation"
	"github.com/coze-dev/coze-loop/backend/modules/observability/infra/rpc/evaluationset"
	"github.com/coze-dev/coze-loop/backend/modules/observability/infra/rpc/evaluator"
	"github.com/coze-dev/coze-loop/backend/modules/observability/infra/rpc/file"
	"github.com/coze-dev/coze-loop/backend/modules/observability/infra/rpc/tag"
	"github.com/coze-dev/coze-loop/backend/modules/observability/infra/rpc/user"
	"github.com/coze-dev/coze-loop/backend/modules/observability/infra/storage"
	"github.com/coze-dev/coze-loop/backend/modules/observability/infra/tenant"
	"github.com/coze-dev/coze-loop/backend/modules/observability/infra/workspace"
	"github.com/coze-dev/coze-loop/backend/pkg/conf"
	"github.com/google/wire"
)

// Injectors from wire.go:

func InitTraceApplication(db2 db.Provider, ckDb ck.Provider, redis3 redis.Cmdable, persistentCmdable redis.PersistentCmdable, meter metrics.Meter, mqFactory mq.IFactory, configFactory conf.IConfigLoaderFactory, idgen2 idgen.IIDGenerator, fileClient fileservice.Client, benefit2 benefit.IBenefitService, authClient authservice.Client, userClient userservice.Client, evalService evaluatorservice.Client, evalSetService evaluationsetservice.Client, tagService tagservice.Client, datasetService datasetservice.Client) (ITraceApplication, error) {
	iConfigLoader, err := NewTraceConfigLoader(configFactory)
	if err != nil {
		return nil, err
	}
	iTraceConfig := config.NewTraceConfigCenter(iConfigLoader)
	iStorageProvider := storage.NewTraceStorageProvider()
	iSpansRedisDao, err := redis2.NewSpansRedisDaoImpl(persistentCmdable)
	if err != nil {
		return nil, err
	}
	iSpanProducer, err := producer.NewSpanWithAnnotationProducerImpl(iTraceConfig, mqFactory)
	if err != nil {
		return nil, err
	}
	iTraceRepo, err := provideTraceRepo(iTraceConfig, iStorageProvider, iSpansRedisDao, ckDb, iSpanProducer)
	if err != nil {
		return nil, err
	}
	iTraceProducer, err := producer.NewTraceProducerImpl(iTraceConfig, mqFactory)
	if err != nil {
		return nil, err
	}
	iAnnotationProducer, err := producer.NewAnnotationProducerImpl(iTraceConfig, mqFactory)
	if err != nil {
		return nil, err
	}
	iTraceMetrics := metrics2.NewTraceMetricsImpl(meter)
	iFileProvider := file.NewFileRPCProvider(fileClient)
	traceFilterProcessorBuilder := NewTraceProcessorBuilder(iTraceConfig, iFileProvider, benefit2)
	iTenantProvider := tenant.NewTenantProvider(iTraceConfig)
	iEvaluatorRPCAdapter := evaluator.NewEvaluatorRPCProvider(evalService)
	iTaskDao := mysql.NewTaskDaoImpl(db2)
	iTaskDAO := redis2.NewTaskDAO(redis3)
	iTaskRunDao := mysql.NewTaskRunDaoImpl(db2)
	iTaskRunDAO := redis2.NewTaskRunDAO(redis3)
	iTaskRepo := repo.NewTaskRepoImpl(iTaskDao, idgen2, iTaskDAO, iTaskRunDao, iTaskRunDAO)
	iTraceService, err := service.NewTraceServiceImpl(iTraceRepo, iTraceConfig, iTraceProducer, iAnnotationProducer, iTraceMetrics, traceFilterProcessorBuilder, iTenantProvider, iEvaluatorRPCAdapter, iTaskRepo, persistentCmdable)
	if err != nil {
		return nil, err
	}
	datasetServiceAdaptor := NewDatasetServiceAdapter(evalSetService, datasetService)
	iTraceExportService, err := service.NewTraceExportServiceImpl(iTraceRepo, iStorageProvider, iTraceConfig, iTraceProducer, iAnnotationProducer, iTraceMetrics, iTenantProvider, datasetServiceAdaptor, traceFilterProcessorBuilder)
	if err != nil {
		return nil, err
	}
	iViewDao := mysql.NewViewDaoImpl(db2)
	iViewRepo := repo.NewViewRepoImpl(iViewDao, idgen2)
	iAuthProvider := auth.NewAuthProvider(authClient)
	iUserProvider := user.NewUserRPCProvider(userClient)
	iTagRPCAdapter := tag.NewTagRPCProvider(tagService)
	iTraceApplication, err := NewTraceApplication(iTraceService, iTraceExportService, iViewRepo, benefit2, iTenantProvider, iTraceMetrics, iTraceConfig, iAuthProvider, iEvaluatorRPCAdapter, iUserProvider, iTagRPCAdapter)
	if err != nil {
		return nil, err
	}
	return iTraceApplication, nil
}

func InitOpenAPIApplication(mqFactory mq.IFactory, configFactory conf.IConfigLoaderFactory, fileClient fileservice.Client, ckDb ck.Provider, benefit2 benefit.IBenefitService, limiterFactory limiter.IRateLimiterFactory, authClient authservice.Client, meter metrics.Meter, db2 db.Provider, redis3 redis.Cmdable, idgen2 idgen.IIDGenerator, evalService evaluatorservice.Client, persistentCmdable redis.PersistentCmdable) (IObservabilityOpenAPIApplication, error) {
	iConfigLoader, err := NewTraceConfigLoader(configFactory)
	if err != nil {
		return nil, err
	}
	iTraceConfig := config.NewTraceConfigCenter(iConfigLoader)
	iStorageProvider := storage.NewTraceStorageProvider()
	iSpansRedisDao, err := redis2.NewSpansRedisDaoImpl(persistentCmdable)
	if err != nil {
		return nil, err
	}
	iSpanProducer, err := producer.NewSpanWithAnnotationProducerImpl(iTraceConfig, mqFactory)
	if err != nil {
		return nil, err
	}
	iTraceRepo, err := provideTraceRepo(iTraceConfig, iStorageProvider, iSpansRedisDao, ckDb, iSpanProducer)
	if err != nil {
		return nil, err
	}
	iTraceProducer, err := producer.NewTraceProducerImpl(iTraceConfig, mqFactory)
	if err != nil {
		return nil, err
	}
	iAnnotationProducer, err := producer.NewAnnotationProducerImpl(iTraceConfig, mqFactory)
	if err != nil {
		return nil, err
	}
	iTraceMetrics := metrics2.NewTraceMetricsImpl(meter)
	iFileProvider := file.NewFileRPCProvider(fileClient)
	traceFilterProcessorBuilder := NewTraceProcessorBuilder(iTraceConfig, iFileProvider, benefit2)
	iTenantProvider := tenant.NewTenantProvider(iTraceConfig)
	iEvaluatorRPCAdapter := evaluator.NewEvaluatorRPCProvider(evalService)
	iTaskDao := mysql.NewTaskDaoImpl(db2)
	iTaskDAO := redis2.NewTaskDAO(redis3)
	iTaskRunDao := mysql.NewTaskRunDaoImpl(db2)
	iTaskRunDAO := redis2.NewTaskRunDAO(redis3)
	iTaskRepo := repo.NewTaskRepoImpl(iTaskDao, idgen2, iTaskDAO, iTaskRunDao, iTaskRunDAO)
	iTraceService, err := service.NewTraceServiceImpl(iTraceRepo, iTraceConfig, iTraceProducer, iAnnotationProducer, iTraceMetrics, traceFilterProcessorBuilder, iTenantProvider, iEvaluatorRPCAdapter, iTaskRepo, persistentCmdable)
	if err != nil {
		return nil, err
	}
	iAuthProvider := auth.NewAuthProvider(authClient)
	iWorkSpaceProvider := workspace.NewWorkspaceProvider()
	iCollectorProvider := collector.NewEventCollectorProvider()
	iObservabilityOpenAPIApplication, err := NewOpenAPIApplication(iTraceService, iAuthProvider, benefit2, iTenantProvider, iWorkSpaceProvider, limiterFactory, iTraceConfig, iTraceMetrics, iCollectorProvider)
	if err != nil {
		return nil, err
	}
	return iObservabilityOpenAPIApplication, nil
}

func InitMetricApplication(ckDb ck.Provider, storageProvider storage2.IStorageProvider, configFactory conf.IConfigLoaderFactory, fileClient fileservice.Client, benefit2 benefit.IBenefitService, authClient authservice.Client) (IMetricApplication, error) {
	iConfigLoader, err := NewTraceConfigLoader(configFactory)
	if err != nil {
		return nil, err
	}
	iTraceConfig := config.NewTraceConfigCenter(iConfigLoader)
	iMetricRepo, err := provideTraceMetricRepo(iTraceConfig, storageProvider, ckDb)
	if err != nil {
		return nil, err
	}
	v := NewMetricDefinitions()
	iTenantProvider := tenant.NewTenantProvider(iTraceConfig)
	iFileProvider := file.NewFileRPCProvider(fileClient)
	traceFilterProcessorBuilder := NewTraceProcessorBuilder(iTraceConfig, iFileProvider, benefit2)
	iMetricsService, err := service2.NewMetricsService(iMetricRepo, v, iTenantProvider, traceFilterProcessorBuilder)
	if err != nil {
		return nil, err
	}
	iAuthProvider := auth.NewAuthProvider(authClient)
	iMetricApplication, err := NewMetricApplication(iMetricsService, iTenantProvider, iAuthProvider)
	if err != nil {
		return nil, err
	}
	return iMetricApplication, nil
}

func InitTraceIngestionApplication(configFactory conf.IConfigLoaderFactory, storageProvider storage2.IStorageProvider, ckDb ck.Provider, mqFactory mq.IFactory, persistentCmdable redis.PersistentCmdable) (ITraceIngestionApplication, error) {
	iConfigLoader, err := NewTraceConfigLoader(configFactory)
	if err != nil {
		return nil, err
	}
	iTraceConfig := config.NewTraceConfigCenter(iConfigLoader)
	iSpansRedisDao, err := redis2.NewSpansRedisDaoImpl(persistentCmdable)
	if err != nil {
		return nil, err
	}
	iSpanProducer, err := producer.NewSpanWithAnnotationProducerImpl(iTraceConfig, mqFactory)
	if err != nil {
		return nil, err
	}
	iTraceRepo, err := provideTraceRepo(iTraceConfig, storageProvider, iSpansRedisDao, ckDb, iSpanProducer)
	if err != nil {
		return nil, err
	}
	ingestionCollectorFactory := NewIngestionCollectorFactory(mqFactory, iTraceRepo)
	ingestionService, err := service.NewIngestionServiceImpl(iConfigLoader, ingestionCollectorFactory)
	if err != nil {
		return nil, err
	}
	iTraceIngestionApplication := NewIngestionApplication(ingestionService)
	return iTraceIngestionApplication, nil
}

func InitTaskApplication(db2 db.Provider, idgen2 idgen.IIDGenerator, configFactory conf.IConfigLoaderFactory, benefit2 benefit.IBenefitService, ckDb ck.Provider, redis3 redis.Cmdable, mqFactory mq.IFactory, userClient userservice.Client, authClient authservice.Client, evalService evaluatorservice.Client, evalSetService evaluationsetservice.Client, exptService experimentservice.Client, datasetService datasetservice.Client, fileClient fileservice.Client, taskProcessor processor.TaskProcessor, aid int32, persistentCmdable redis.PersistentCmdable) (ITaskApplication, error) {
	iTaskDao := mysql.NewTaskDaoImpl(db2)
	iTaskDAO := redis2.NewTaskDAO(redis3)
	iTaskRunDao := mysql.NewTaskRunDaoImpl(db2)
	iTaskRunDAO := redis2.NewTaskRunDAO(redis3)
	iTaskRepo := repo.NewTaskRepoImpl(iTaskDao, idgen2, iTaskDAO, iTaskRunDao, iTaskRunDAO)
	iConfigLoader, err := NewTraceConfigLoader(configFactory)
	if err != nil {
		return nil, err
	}
	iTraceConfig := config.NewTraceConfigCenter(iConfigLoader)
	iBackfillProducer, err := producer.NewBackfillProducerImpl(iTraceConfig, mqFactory)
	if err != nil {
		return nil, err
	}
	datasetServiceAdaptor := NewDatasetServiceAdapter(evalSetService, datasetService)
	iEvaluatorRPCAdapter := evaluator.NewEvaluatorRPCProvider(evalService)
	iEvaluationRPCAdapter := evaluation.NewEvaluationRPCProvider(exptService)
	processorTaskProcessor := NewInitTaskProcessor(datasetServiceAdaptor, iEvaluatorRPCAdapter, iEvaluationRPCAdapter, iTaskRepo)
	iStorageProvider := storage.NewTraceStorageProvider()
	iTenantProvider := tenant.NewTenantProvider(iTraceConfig)
	iFileProvider := file.NewFileRPCProvider(fileClient)
	traceFilterProcessorBuilder := NewTraceProcessorBuilder(iTraceConfig, iFileProvider, benefit2)
	iTaskService, err := service3.NewTaskServiceImpl(iTaskRepo, idgen2, iBackfillProducer, processorTaskProcessor, iStorageProvider, iTenantProvider, traceFilterProcessorBuilder)
	if err != nil {
		return nil, err
	}
	iAuthProvider := auth.NewAuthProvider(authClient)
	iUserProvider := user.NewUserRPCProvider(userClient)
	iSpansRedisDao, err := redis2.NewSpansRedisDaoImpl(persistentCmdable)
	if err != nil {
		return nil, err
	}
	iSpanProducer, err := producer.NewSpanWithAnnotationProducerImpl(iTraceConfig, mqFactory)
	if err != nil {
		return nil, err
	}
	iTraceRepo, err := provideTraceRepo(iTraceConfig, iStorageProvider, iSpansRedisDao, ckDb, iSpanProducer)
	if err != nil {
		return nil, err
	}
	iLocker := NewTaskLocker(redis3)
	iTraceHubService, err := tracehub.NewTraceHubImpl(iTaskRepo, iTraceRepo, iTenantProvider, traceFilterProcessorBuilder, processorTaskProcessor, aid, iBackfillProducer, iLocker, iTraceConfig)
	if err != nil {
		return nil, err
	}
	iTaskCallbackService := service3.NewTaskCallbackServiceImpl(iTaskRepo, iTraceRepo, taskProcessor, iTenantProvider, iTraceConfig, benefit2)
	v := NewScheduledTask(iLocker, iTraceConfig, iTraceHubService, iTaskService, taskProcessor, iTaskRepo)
	iTaskApplication, err := NewTaskApplication(iTaskService, iAuthProvider, iEvaluatorRPCAdapter, iEvaluationRPCAdapter, iUserProvider, iTraceHubService, taskProcessor, iTaskCallbackService, v, iTraceRepo)
	if err != nil {
		return nil, err
	}
	return iTaskApplication, nil
}

// wire.go:

var (
	taskDomainSet = wire.NewSet(
		NewInitTaskProcessor, service3.NewTaskServiceImpl, repo.NewTaskRepoImpl, mysql.NewTaskDaoImpl, redis2.NewTaskDAO, redis2.NewTaskRunDAO, mysql.NewTaskRunDaoImpl, producer.NewBackfillProducerImpl, NewScheduledTask,
	)
	traceDomainSet = wire.NewSet(service.NewTraceServiceImpl, service.NewTraceExportServiceImpl, provideTraceRepo, storage.NewTraceStorageProvider, metrics2.NewTraceMetricsImpl, collector.NewEventCollectorProvider, producer.NewTraceProducerImpl, producer.NewAnnotationProducerImpl, producer.NewSpanWithAnnotationProducerImpl, file.NewFileRPCProvider, NewTraceConfigLoader,
		NewTraceProcessorBuilder, config.NewTraceConfigCenter, tenant.NewTenantProvider, workspace.NewWorkspaceProvider, evaluator.NewEvaluatorRPCProvider, NewDatasetServiceAdapter, redis2.NewSpansRedisDaoImpl, taskDomainSet,
	)
	traceSet = wire.NewSet(
		NewTraceApplication, repo.NewViewRepoImpl, mysql.NewViewDaoImpl, auth.NewAuthProvider, user.NewUserRPCProvider, tag.NewTagRPCProvider, traceDomainSet,
	)
	traceIngestionSet = wire.NewSet(
		NewIngestionApplication, service.NewIngestionServiceImpl, provideTraceRepo, config.NewTraceConfigCenter, NewTraceConfigLoader,
		NewIngestionCollectorFactory, producer.NewSpanWithAnnotationProducerImpl, redis2.NewSpansRedisDaoImpl,
	)
	openApiSet = wire.NewSet(
		NewOpenAPIApplication, auth.NewAuthProvider, traceDomainSet,
	)
	taskSet = wire.NewSet(tracehub.NewTraceHubImpl, NewTaskApplication, auth.NewAuthProvider, user.NewUserRPCProvider, evaluation.NewEvaluationRPCProvider, NewTaskLocker,
		traceDomainSet, service3.NewTaskCallbackServiceImpl,
	)
	metricsSet = wire.NewSet(
		NewMetricApplication, service2.NewMetricsService, provideTraceMetricRepo, tenant.NewTenantProvider, auth.NewAuthProvider, NewTraceConfigLoader,
		NewTraceProcessorBuilder, config.NewTraceConfigCenter, NewMetricDefinitions, file.NewFileRPCProvider,
	)
)

func provideTraceRepo(
	traceConfig config2.ITraceConfig,
	storageProvider storage2.IStorageProvider,
	spanRedisDao redis2.ISpansRedisDao,
	ckProvider ck.Provider,
	spanProducer mq2.ISpanProducer,
) (repo2.ITraceRepo, error) {
	options, err := buildTraceRepoOptions(ckProvider)
	if err != nil {
		return nil, err
	}
	return repo.NewTraceRepoImpl(traceConfig, storageProvider, spanRedisDao, spanProducer, options...)
}

func provideTraceMetricRepo(
	traceConfig config2.ITraceConfig,
	storageProvider storage2.IStorageProvider,
	ckProvider ck.Provider,
) (repo3.IMetricRepo, error) {
	options, err := buildTraceRepoOptions(ckProvider)
	if err != nil {
		return nil, err
	}
	return repo.NewTraceMetricCKRepoImpl(traceConfig, storageProvider, options...)
}

func buildTraceRepoOptions(ckProvider ck.Provider) ([]repo.TraceRepoOption, error) {
	ckSpanDao, err := ck2.NewSpansCkDaoImpl(ckProvider)
	if err != nil {
		return nil, err
	}
	ckAnnoDao, err := ck2.NewAnnotationCkDaoImpl(ckProvider)
	if err != nil {
		return nil, err
	}
	return []repo.TraceRepoOption{repo.WithTraceStorageDaos(ck2.TraceStorageTypeCK, ckSpanDao, ckAnnoDao)}, nil
}

func NewTaskLocker(cmdable redis.Cmdable) lock.ILocker {
	return lock.NewRedisLockerWithHolder(cmdable, "observability")
}

func NewTraceProcessorBuilder(
	traceConfig config2.ITraceConfig,
	fileProvider rpc.IFileProvider,
	benefitSvc benefit.IBenefitService,
) service.TraceFilterProcessorBuilder {
	return service.NewTraceFilterProcessorBuilder(span_filter.NewPlatformFilterFactory(
		[]span_filter.Factory{span_filter.NewCozeLoopFilterFactory(), span_filter.NewPromptFilterFactory(traceConfig), span_filter.NewEvaluatorFilterFactory(), span_filter.NewEvalTargetFilterFactory()}), []span_processor.Factory{span_processor.NewPlatformProcessorFactory(traceConfig), span_processor.NewCheckProcessorFactory(), span_processor.NewAttrTosProcessorFactory(fileProvider), span_processor.NewExpireErrorProcessorFactory(benefitSvc)},

		[]span_processor.Factory{span_processor.NewPlatformProcessorFactory(traceConfig), span_processor.NewExpireErrorProcessorFactory(benefitSvc)},

		[]span_processor.Factory{span_processor.NewCheckProcessorFactory()},

		[]span_processor.Factory{},

		[]span_processor.Factory{span_processor.NewPlatformProcessorFactory(traceConfig), span_processor.NewCheckProcessorFactory(), span_processor.NewAttrTosProcessorFactory(fileProvider), span_processor.NewExpireErrorProcessorFactory(benefitSvc)},

		[]span_processor.Factory{span_processor.NewPlatformProcessorFactory(traceConfig), span_processor.NewExpireErrorProcessorFactory(benefitSvc)})
}

func NewMetricDefinitions() []entity.IMetricDefinition {
	return []entity.IMetricDefinition{general.NewGeneralTotalCountMetric(), general.NewGeneralFailRatioMetric(), general.NewGeneralModelTotalTokensMetric(), general.NewGeneralModelLatencyMetric(), general.NewGeneralModelFailRatioMetric(), general.NewGeneralToolTotalCountMetric(), general.NewGeneralToolLatencyMetric(), general.NewGeneralToolFailRatioMetric(), model.NewModelDurationMetric(), model.NewModelInputTokenCountMetric(), model.NewModelOutputTokenCountMetric(), model.NewModelNamePieMetric(), model.NewModelQPMAllMetric(), model.NewModelQPMFailMetric(), model.NewModelQPMSuccessMetric(), model.NewModelQPSAllMetric(), model.NewModelQPSFailMetric(), model.NewModelQPSSuccessMetric(), model.NewModelSuccessRatioMetric(), model.NewModelSystemTokenCountMetric(), model.NewModelTokenCountMetric(), model.NewModelTokenCountPieMetric(), model.NewModelToolChoiceTokenCountMetric(), model.NewModelTPMMetric(), model.NewModelTPOTMetric(), model.NewModelTPSMetric(), model.NewModelTTFTMetric(), service4.NewServiceDurationMetric(), service4.NewServiceExecutionStepCountMetric(), service4.NewServiceMessageCountMetric(), service4.NewServiceQPMAllMetric(), service4.NewServiceQPMSuccessMetric(), service4.NewServiceQPMFailMetric(), service4.NewServiceQPSAllMetric(), service4.NewServiceQPSSuccessMetric(), service4.NewServiceQPSFailMetric(), service4.NewServiceSpanCountMetric(), service4.NewServiceSuccessRatioMetric(), service4.NewServiceTraceCountMetric(), service4.NewServiceUserCountMetric(), tool.NewToolDurationMetric(), tool.NewToolNamePieMetric(), tool.NewToolSuccessRatioMetric(), tool.NewToolTotalCountMetric()}
}

func NewIngestionCollectorFactory(mqFactory mq.IFactory, traceRepo repo2.ITraceRepo) service.IngestionCollectorFactory {
	return service.NewIngestionCollectorFactory(
		[]receiver.Factory{rmqreceiver.NewFactory(mqFactory)},
		[]processor2.Factory{queueprocessor.NewFactory()},
		[]exporter.Factory{clickhouseexporter.NewFactory(traceRepo)},
	)
}

func NewTraceConfigLoader(confFactory conf.IConfigLoaderFactory) (conf.IConfigLoader, error) {
	return confFactory.NewConfigLoader("observability.yaml")
}

func NewDatasetServiceAdapter(evalSetService evaluationsetservice.Client, datasetService datasetservice.Client) *service.DatasetServiceAdaptor {
	adapter := service.NewDatasetServiceAdaptor()
	datasetProvider := dataset.NewDatasetProvider(datasetService)
	adapter.Register(entity2.DatasetCategory_Evaluation, evaluationset.NewEvaluationSetProvider(evalSetService, datasetProvider))
	return adapter
}

func NewInitTaskProcessor(datasetServiceProvider *service.DatasetServiceAdaptor, evalService rpc.IEvaluatorRPCAdapter,
	evaluationService rpc.IEvaluationRPCAdapter, taskRepo repo4.ITaskRepo,
) *processor.TaskProcessor {
	taskProcessor := processor.NewTaskProcessor()
	taskProcessor.Register(entity3.TaskTypeAutoEval, processor.NewAutoEvaluteProcessor(0, datasetServiceProvider, evalService, evaluationService, taskRepo))
	return taskProcessor
}

func NewScheduledTask(
	locker lock.ILocker, config3 config2.ITraceConfig,

	traceHubService tracehub.ITraceHubService,
	taskService service3.ITaskService,
	taskProcessor processor.TaskProcessor,
	taskRepo repo4.ITaskRepo,
) []scheduledtask.ScheduledTask {
	return []scheduledtask.ScheduledTask{scheduledtask2.NewStatusCheckTask(locker, config3, traceHubService, taskService, taskProcessor, taskRepo), scheduledtask2.NewLocalCacheRefreshTask(traceHubService, taskRepo)}
}
